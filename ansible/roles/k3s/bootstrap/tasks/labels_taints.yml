---
- name: Apply storage annotations
  ignore_errors: yes
  command: kubectl label node {{ item }} node-role.kubernetes.io/storage=true
  loop: "{{ groups['storage'] }}"
  environment:
    KUBECONFIG: "{{ REPO_ROOT }}/kubeconfig"

- name: Apply ceph annotations
  ignore_errors: yes
  command: kubectl label node {{ item }} node-role.kubernetes.io/ceph=true
  loop: "{{ groups['ceph'] }}"
  environment:
    KUBECONFIG: "{{ REPO_ROOT }}/kubeconfig"

- name: Apply worker annotations
  ignore_errors: yes
  command: kubectl label node {{ item }} node-role.kubernetes.io/worker=true
  loop: "{{ groups['nodes'] }}"
  environment:
    KUBECONFIG: "{{ REPO_ROOT }}/kubeconfig"

- name: Apply master annotations
  ignore_errors: yes
  command: kubectl taint --overwrite node {{ item }} node-role.kubernetes.io/master=true:NoSchedule
  loop: "{{ groups['master'] }}"
  environment:
    KUBECONFIG: "{{ REPO_ROOT }}/kubeconfig"
